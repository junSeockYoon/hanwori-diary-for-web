<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒì„¸ë³´ê¸° - í•œìš°ë¦¬ ë‹¤ì´ì–´ë¦¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: Arial, sans-serif;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        textarea {
            min-height: 200px;
            resize: vertical;
        }

        .button-group {
            text-align: center;
            margin-top: 30px;
        }

        button {
            padding: 12px 24px;
            margin: 0 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-save {
            background-color: #4CAF50;
            color: white;
        }

        .btn-save:hover {
            background-color: #45a049;
        }

        .btn-cancel {
            background-color: #f44336;
            color: white;
        }

        .btn-cancel:hover {
            background-color: #da190b;
        }

        .btn-back {
            background-color: #2196F3;
            color: white;
        }

        .btn-back:hover {
            background-color: #1976D2;
        }

        .btn-delete {
            background-color: #ff4444;
            color: white;
        }

        .btn-delete:hover {
            background-color: #cc0000;
        }

        .meta-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            color: #666;
        }

        .meta-info span {
            margin-right: 20px;
        }

        .edit-mode {
            border: 2px solid #4CAF50;
            background-color: #f9f9f9;
        }

        .view-mode {
            border: 1px solid #ddd;
            background-color: white;
        }

        .readonly {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“– ë‹¤ì´ì–´ë¦¬ ìƒì„¸ë³´ê¸°</h1>
        
        <% if (result && result.length > 0) { %>
            <% let post = result[0]; %>
            
            <div class="meta-info">
                <span><strong>ë²ˆí˜¸:</strong> <%= post.id %></span>
                <span><strong>ì‘ì„±ì¼:</strong> <%= post.createDt %></span>
                <span><strong>ìˆ˜ì •ì¼:</strong> <%= post.modifyDate || 'ìˆ˜ì •ë˜ì§€ ì•ŠìŒ' %></span>
            </div>

            <div class="form-group">
                <label for="title">ì œëª©</label>
                <input type="text" id="title" value="<%= post.title %>" class="readonly" readonly>
            </div>

            <div class="form-group">
                <label for="content">ë‚´ìš©</label>
                <textarea id="content" class="readonly" readonly><%= post.content %></textarea>
            </div>

            <div class="button-group"  id="button-group">
                <button type="button" class="btn-back" onclick="location.href='/'">ëª©ë¡ìœ¼ë¡œ</button>
                <button type="button" class="btn-save" id="editBtn" onclick="toggleEdit()">ìˆ˜ì •í•˜ê¸°</button>
                <button type="button" class="btn-save" id="saveBtn" style="display: none;" onclick="savePost()">ì €ì¥í•˜ê¸°</button>
                <button type="button" class="btn-cancel" id="cancelBtn" style="display: none;" onclick="cancelEdit()">ì·¨ì†Œ</button>
                <button type="button" class="btn-delete" onclick="deletePost()">ì‚­ì œí•˜ê¸°</button>
            </div>
            <button type="button" class="btn-back" onclick="update()">ëª©ë¡ìœ¼ë¡œ</button>
        <% } else { %>
            <div style="text-align: center; padding: 40px; color: #666;">
                <h3>ğŸ“ ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                <p>ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì´ê±°ë‚˜ ì‚­ì œëœ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</p>
                <button type="button" class="btn-back" onclick="location.href='/'">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        <% } %>
    </div>

    <script>
        function toggleEdit() {
            const titleInput = document.getElementById('title');
            const contentTextarea = document.getElementById('content');
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            // í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜
            titleInput.classList.remove('readonly');
            titleInput.classList.add('edit-mode');
            titleInput.readOnly = false;

            contentTextarea.classList.remove('readonly');
            contentTextarea.classList.add('edit-mode');
            contentTextarea.readOnly = false;

            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
            cancelBtn.style.display = 'inline-block';

            // ì œëª©ì— í¬ì»¤ìŠ¤
            titleInput.focus();
        }

        function cancelEdit() {
            const titleInput = document.getElementById('title');
            const contentTextarea = document.getElementById('content');
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const cancelBtn = document.getElementById('cancelBtn');

            // ì›ë˜ ê°’ìœ¼ë¡œ ë³µì›
            titleInput.value = '<%= result && result[0] ? result[0].title : "" %>';
            contentTextarea.value = '<%= result && result[0] ? result[0].content : "" %>';

            // ì½ê¸° ì „ìš© ëª¨ë“œë¡œ ì „í™˜
            titleInput.classList.remove('edit-mode');
            titleInput.classList.add('readonly');
            titleInput.readOnly = true;

            contentTextarea.classList.remove('edit-mode');
            contentTextarea.classList.add('readonly');
            contentTextarea.readOnly = true;

            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            editBtn.style.display = 'inline-block';
            saveBtn.style.display = 'none';
            cancelBtn.style.display = 'none';
        }

        // AJAX ìˆ˜ì • í•¨ìˆ˜
        async function savePost() {
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            const postId = '<%= result && result[0] ? result[0].id : "" %>';

            try {
                showMessage('ìˆ˜ì • ì¤‘...', 'info');
                
                const response = await fetch(`/update/${postId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        content: content
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showMessage('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    // í¸ì§‘ ëª¨ë“œ í•´ì œ
                    cancelEdit();
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ìµœì‹  ë°ì´í„° ë°˜ì˜
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else {
                    showMessage('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                }
            } catch (error) {
                console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
                showMessage('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // AJAX ì‚­ì œ í•¨ìˆ˜
        async function deletePost() {
            if (confirm('ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê²Œì‹œê¸€ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                if (confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const postId = '<%= result && result[0] ? result[0].id : "" %>';
                    
                    try {
                        showMessage('ì‚­ì œ ì¤‘...', 'info');
                        
                        const response = await fetch(`/delete/${postId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            }
                        });

                        const result = await response.json();

                        if (result.success) {
                            showMessage('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                            // ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™
                            setTimeout(() => {
                                location.href = '/';
                            }, 1500);
                        } else {
                            showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        }
                    } catch (error) {
                        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                        showMessage('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                    }
                }
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(message, type) {
            // ê¸°ì¡´ ë©”ì‹œì§€ ì œê±°
            const existingMessage = document.querySelector('.message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // ìƒˆ ë©”ì‹œì§€ ìƒì„±
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.textContent = message;
            
            // ìŠ¤íƒ€ì¼ ì ìš©
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                animation: slideIn 0.3s ease-out;
            `;

            // íƒ€ì…ë³„ ìƒ‰ìƒ ì„¤ì •
            if (type === 'success') {
                messageDiv.style.backgroundColor = '#4CAF50';
            } else if (type === 'error') {
                messageDiv.style.backgroundColor = '#f44336';
            } else if (type === 'info') {
                messageDiv.style.backgroundColor = '#2196F3';
            }

            document.body.appendChild(messageDiv);

            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (messageDiv.parentNode) {
                            messageDiv.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }

        // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        function update() {
            let id = '<%= result && result[0] ? result[0].id : "" %>';
            let title = document.getElementById('title').value;
            let content = document.getElementById('content').value; 
            let params = { id, title, content };
            console.log(params);
        }
    </script>
</body>
</html>
